<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Details</title>
    <!-- Include Esri's JavaScript API -->
    <script src="https://js.arcgis.com/4.24/"></script>
    <style>
        /* Add CSS styles here */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        .form-container {
            width: 25%;
            float: left;
        }
        .map-container {
            width: 75%;
            float: right;
            position: relative;
        }
        .coordinates-display {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            z-index: 1000;
        }
        #addProjectButton {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        #reviewSubmitButton {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .map-controls button {
            padding: 8px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-group input[type="file"] {
            padding: 5px;
        }
        .form-group input[type="submit"] {
            display: none; /* Hide the submit button */
        }
        #map {
            height: 600px;
            width: 100%;
        }
        #instructionBox {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            z-index: 1000;
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Project Details</h1>

    <div class="container">
        <div class="form-container">
            <form id="projectDetailsForm">
                <div class="form-group">
                    <label for="projectTitle">Project Title</label>
                    <input type="text" id="projectTitle" name="projectTitle" placeholder="eg. Construction of Evacuation Center" required>
                </div>
                <div class="form-group">
                    <label for="street">Street/Purok/Sitio</label>
                    <input type="text" id="street" name="street" placeholder="eg. Rizal St. / Purok 5 / Sitio" required>
                </div>
                <div class="form-group">
                    <label for="barangay">Barangay</label>
                    <input type="text" id="barangay" name="barangay" required>
                </div>
                <div class="form-group">
                    <label for="city">City/Municipality</label>
                    <input type="text" id="city" name="city" required>
                </div>
                <div class="form-group">
                    <label for="province">Province</label>
                    <input type="text" id="province" name="province" required>
                </div>
                <div class="form-group" id="singleStructureCoords" style="display: block;">
                    <label for="latitude">Latitude</label>
                    <input type="text" id="latitude" name="latitude" readonly>
                    <label for="longitude">Longitude</label>
                    <input type="text" id="longitude" name="longitude" readonly>
                </div>
                <div class="form-group">
                    <label for="sitePhotos">Upload Site Photos</label>
                    <input type="file" id="sitePhotos" name="sitePhotos" accept="image/*" multiple required>
                </div>
                <input type="button" id="addProjectButton" value="Add Another Project" onclick="addProject()">
                <input type="button" id="reviewSubmitButton" value="Review & Submit" onclick="reviewAndSubmit()">
            </form>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <div id="coordinates" class="coordinates-display"></div>
            <div class="map-controls">
                <button onclick="zoomIn()">Zoom In</button>
                <button onclick="zoomOut()">Zoom Out</button>
            </div>
        </div>
    </div>

    <div id="projectTableContainer">
        <table id="projectTable">
            <thead>
                <tr>
                    <th>Project Title</th>
                    <th>Street/Purok/Sitio</th>
                    <th>Barangay</th>
                    <th>City/Municipality</th>
                    <th>Province</th>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Project details will be added here dynamically -->
            </tbody>
        </table>
    </div>

    <!-- JavaScript code to initialize the map and handle user interactions -->
    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Graphic",
            "esri/layers/GraphicsLayer",
            "esri/symbols/SimpleMarkerSymbol",
            "dojo/domReady!"
        ], function(Map, MapView, Graphic, GraphicsLayer, SimpleMarkerSymbol) {
            var map = new Map({
                basemap: "satellite"
            });

            var view = new MapView({
                container: "map",
                map: map,
                center: [122.845189, 7.729885], // Default center
                zoom: 9, // Default zoom level
                navigationToggle: false // Disable default zoom in and zoom out controls
            });

            var graphicsLayer = new GraphicsLayer();

            map.add(graphicsLayer);

            var currentGraphic = null;

            view.on("click", function(event) {
                var formData = new FormData(document.getElementById("projectDetailsForm"));
                addSingleStructure(event.mapPoint.latitude, event.mapPoint.longitude, formData);
            });

            function addSingleStructure(latitude, longitude, formData) {
                // Clear the previous graphic
                if (currentGraphic) {
                    graphicsLayer.remove(currentGraphic);
                }

                // Update form fields with new coordinates
                document.getElementById("latitude").value = latitude.toFixed(6);
                document.getElementById("longitude").value = longitude.toFixed(6);

                // Create a new marker symbol
                var markerSymbol = new SimpleMarkerSymbol({
                    color: [226, 119, 40],
                    outline: {
                        color: [255, 255, 255],
                        width: 1
                    }
                });

                // Create a new graphic with the marker symbol at the clicked location
                var graphic = new Graphic({
                    geometry: {
                        type: "point",
                        latitude: latitude,
                        longitude: longitude
                    },
                    symbol: markerSymbol
                });

                // Add the new graphic to the graphics layer
                graphicsLayer.add(graphic);

                // Store reference to the current graphic
                currentGraphic = graphic;
            }

            window.addProject = function() {
                var formData = new FormData(document.getElementById("projectDetailsForm"));
                var projectTitle = formData.get("projectTitle");
                var street = formData.get("street");
                var barangay = formData.get("barangay");
                var city = formData.get("city");
                var province = formData.get("province");
                var latitude = formData.get("latitude");
                var longitude = formData.get("longitude");

                // Create a new row in the table
                var table = document.getElementById("projectTable").getElementsByTagName('tbody')[0];
                var newRow = table.insertRow();
                var cell1 = newRow.insertCell(0);
                var cell2 = newRow.insertCell(1);
                var cell3 = newRow.insertCell(2);
                var cell4 = newRow.insertCell(3);
                var cell5 = newRow.insertCell(4);
                var cell6 = newRow.insertCell(5);
                var cell7 = newRow.insertCell(6);
                var cell8 = newRow.insertCell(7); // Add cell for actions

                // Add data to the new row
                cell1.innerHTML = projectTitle;
                cell2.innerHTML = street;
                cell3.innerHTML = barangay;
                cell4.innerHTML = city;
                cell5.innerHTML = province;
                cell6.innerHTML = latitude;
                cell7.innerHTML = longitude;

                // Add delete button
                var deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.onclick = function() {
                    // Implement delete functionality here
                    var row = this.parentNode.parentNode;
                    row.parentNode.removeChild(row);
                    graphicsLayer.remove(graphicsLayer.graphics.filter(function(graphic) {
                        return graphic.geometry.latitude === parseFloat(latitude) && graphic.geometry.longitude === parseFloat(longitude);
                    })[0]);
                };
                cell8.appendChild(deleteButton);

                // Reset the form
                document.getElementById("projectDetailsForm").reset();
            };

            window.reviewAndSubmit = function() {
                // Handle review and submit logic here
                alert("Review and submit functionality not implemented yet!");
            };

            window.zoomIn = function() {
                view.zoom += 1;
            };

            window.zoomOut = function() {
                view.zoom -= 1;
            };

            // Show coordinates on hover
            view.on("pointer-move", function(event) {
                var coordinates = view.toMap({ x: event.x, y: event.y });
                document.getElementById("coordinates").innerHTML = "Latitude: " + coordinates.latitude.toFixed(6) + ", Longitude: " + coordinates.longitude.toFixed(6);
            });
        });
    </script>
</body>
</html>
