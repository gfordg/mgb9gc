<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Details</title>
    <!-- Include Esri's JavaScript API -->
    <script src="https://js.arcgis.com/4.24/"></script>
    <style>
        /* Add CSS styles here */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            
        }
        .form-container {
            width: 25%;
            float: left;
        }
        .map-container {
            width: 70%;
            float: right;
            position: relative;
            
        }
        #addProjectButton {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        #reviewSubmitButton {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-group input[type="file"] {
            padding: 5px;
        }
        .form-group input[type="submit"] {
            display: none; /* Hide the submit button */
        }
        #map {
            height: 600px;
            width: 100%;
        }
        #instructionBox {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Project Details</h1>

    <div class="container">
        <div class="form-container">
            <form id="projectDetailsForm">
                <div class="form-group">
                    <label for="projectType">Project Type</label>
                    <select id="projectType" name="projectType" onchange="toggleForm()">
                        <option value="singleStructure">Single Structure</option>
                        <option value="linearProject">Linear Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectTitle">Project Title</label>
                    <input type="text" id="projectTitle" name="projectTitle" placeholder="eg. Construction of Evacuation Center" required>
                </div>
                <div class="form-group">
                    <label for="street">Street/Purok/Sitio</label>
                    <input type="text" id="street" name="street" placeholder="eg. Rizal St. / Purok 5 / Sitio" required>
                </div>
                <div class="form-group">
                    <label for="barangay">Barangay</label>
                    <input type="text" id="barangay" name="barangay" required>
                </div>
                <div class="form-group">
                    <label for="city">City/Municipality</label>
                    <input type="text" id="city" name="city" required>
                </div>
                <div class="form-group">
                    <label for="province">Province</label>
                    <input type="text" id="province" name="province" required>
                </div>
                <div class="form-group" id="singleStructureCoords" style="display: block;">
                    <label for="latitude">Latitude</label>
                    <input type="text" id="latitude" name="latitude" readonly>
                    <label for="longitude">Longitude</label>
                    <input type="text" id="longitude" name="longitude" readonly>
                </div>
                <div class="form-group" id="linearProjectCoords" style="display: none;">
                    <label for="startLatitude">Start Coordinates</label>
                    <div>
                        <label for="startLatitude">Latitude</label>
                        <input type="text" id="startLatitude" name="startLatitude" readonly>
                    </div>
                    <div>
                        <label for="startLongitude">Longitude</label>
                        <input type="text" id="startLongitude" name="startLongitude" readonly>
                    </div>
                    <label for="endLatitude">End Coordinates</label>
                    <div>
                        <label for="endLatitude">Latitude</label>
                        <input type="text" id="endLatitude" name="endLatitude" readonly>
                    </div>
                    <div>
                        <label for="endLongitude">Longitude</label>
                        <input type="text" id="endLongitude" name="endLongitude" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label for="sitePhotos">Upload Site Photos</label>
                    <input type="file" id="sitePhotos" name="sitePhotos" accept="image/*" multiple required>
                </div>
            </form>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <div id="instructionBox"></div>
            <button id="addProjectButton" onclick="addProject()">Add Another Project</button>
            <button id="reviewSubmitButton" onclick="reviewAndSubmit()">Review & Submit</button>
        </div>
    </div>

    <!-- JavaScript code to initialize the map and handle user interactions -->
    <script>
        require([
    "esri/Map",
    "esri/views/MapView",
    "esri/geometry/Polyline",
    "esri/Graphic",
    "esri/symbols/SimpleLineSymbol",
    "esri/symbols/SimpleMarkerSymbol",
    "dojo/domReady!"
], function(Map, MapView, Polyline, Graphic, SimpleLineSymbol, SimpleMarkerSymbol) {
    var map = new Map({
        basemap: "satellite"
    });

    var view = new MapView({
        container: "map",
        map: map,
        center: [122.845189, 7.729885], // Default center
        zoom: 9 // Default zoom level
    });

    var instructionBox = document.getElementById("instructionBox");
    var points = []; // Array to store clicked points
    var polylineGraphic = null;

    view.on("click", function(event) {
        var formData = new FormData(document.getElementById("projectDetailsForm"));
        var projectType = formData.get("projectType");

        if (projectType === "singleStructure") {
            addSingleStructure(event.mapPoint.latitude, event.mapPoint.longitude);
        } else if (projectType === "linearProject") {
            addLinearProject(event.mapPoint.latitude, event.mapPoint.longitude);
        }
    });

    // Right-click event listener
    view.on("pointer-down", function(event) {
        if (event.button === 2) { // Check if the right mouse button was clicked
            event.stopPropagation(); // Prevent the default right-click behavior
            var formData = new FormData(document.getElementById("projectDetailsForm"));
            var projectType = formData.get("projectType");

            if (projectType === "linearProject" && points.length > 0) {
                // Remove the last point from the points array
                points.pop();
                // Update the polyline on the map
                updatePolyline();
            }
        }
    });

    function addSingleStructure(latitude, longitude) {
    // Remove existing graphics from the view
    view.graphics.removeAll();

    // Update form fields with new coordinates
    document.getElementById("latitude").value = latitude.toFixed(6);
    document.getElementById("longitude").value = longitude.toFixed(6);

    // Create a new marker symbol
    var markerSymbol = new SimpleMarkerSymbol({
        color: [226, 119, 40],
        outline: {
            color: [255, 255, 255],
            width: 1
        }
    });

    // Create a new graphic with the marker symbol at the clicked location
    var graphic = new Graphic({
        geometry: {
            type: "point",
            latitude: latitude,
            longitude: longitude
        },
        symbol: markerSymbol
    });

    // Add the new graphic to the view
    view.graphics.add(graphic);
}


    function addLinearProject(latitude, longitude) {
        points.push([longitude.toFixed(6), latitude.toFixed(6)]);
        updatePolyline();
    }

    function updatePolyline() {
        var lineSymbol = new SimpleLineSymbol({
            color: [226, 119, 40],
            width: 4
        });
        var lineGeometry = new Polyline({
            paths: points,
            spatialReference: { wkid: 4326 }
        });
        if (polylineGraphic) {
            view.graphics.remove(polylineGraphic);
        }
        polylineGraphic = new Graphic({
            geometry: lineGeometry,
            symbol: lineSymbol
        });
        view.graphics.add(polylineGraphic);
        if (points.length > 1) {
            instructionBox.textContent = "Click to continue drawing or finish";
            // Update start and end coordinates on the form
            document.getElementById("startLatitude").value = points[0][1];
            document.getElementById("startLongitude").value = points[0][0];
            document.getElementById("endLatitude").value = points[points.length - 1][1];
            document.getElementById("endLongitude").value = points[points.length - 1][0];
        } else {
            instructionBox.textContent = "Click to add more points";
        }
    }

    window.addProject = function() {
        document.getElementById("projectDetailsForm").reset();
        view.graphics.removeAll();
        points = [];
        polylineGraphic = null;
        instructionBox.textContent = "";
    };

    window.reviewAndSubmit = function() {
        // Handle review and submit logic here
    };

    window.toggleForm = function() {
        var projectType = document.getElementById("projectType").value;
        var singleStructureCoords = document.getElementById("singleStructureCoords");
        var linearProjectCoords = document.getElementById("linearProjectCoords");
        if (projectType === "singleStructure") {
            singleStructureCoords.style.display = "block";
            linearProjectCoords.style.display = "none";
        } else if (projectType === "linearProject") {
            singleStructureCoords.style.display = "none";
            linearProjectCoords.style.display = "block";
        }
    };
});

    </script>
</body>
</html>
